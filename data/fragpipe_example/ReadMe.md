# FragPipe example (LFQ)

The integration of PickedGroupFDR with FragPipe is realized by updating the `psm.tsv` and `protein.tsv` files in each of the experiment folders of FragPipe. An updated version of `combined_protein.tsv` is generated by using the `combined_ion.tsv` from an earlier FragPipe run or by rerunning the [IonQuant](https://ionquant.nesvilab.org/) software on the updated `psm.tsv` and `protein.tsv` files.

The data consists of 9 RAW files with different pools of PrESTs spiked into an E. coli background.
The dataset is described in this publication: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6474350/

To run this example, follow these steps:

## Option 1: reuse previous FragPipe results

**Download FragPipe result files**

1. Download the `fragpipe.zip` file from this folder. It contains the necessary FragPipe results files needed to run this example. For the FragPipe settings used to generate these files, see step 4 in Option 2.

**Running PickedGroupFDR**

2. Run the `run_picked_group_fdr.sh` script. This runs the `picked_group_fdr` and `picked_group_fdr.pipeline.update_fragpipe_results` modules.

A quantified protein group result in FragPipe format will be available at `results_from_combined_ion/combined_protein.tsv`.

As additional files, it will produce a protein grouping result similar to MaxQuant's proteinGroups.txt format at `results/proteinGroups.txt`, as well as updated `psm.tsv` and `protein.tsv` file for each experiment.


## Option 2: run FragPipe yourself

**Download RAW files and FragPipe**

1. Download the `mixture{A,B,AB}rep{1,2,3}.raw` files from the PRIDE repository [PXD008425](https://www.ebi.ac.uk/pride/archive/projects/PXD008425) into a new subfolder named `RAW`.
2. Download and install FragPipe (version used for this example was v19.1).

**Running FragPipe**

3. Run the standard LFQ workflow using the fasta file `iprg2016_with_labels.fasta` included in this folder.
4. In the `Validation` tab, in the `FDR Filter and Report` section, tick the `Print decoys` checkbox and add the following in the `Filter` field.
   ```
   --sequential --prot 1.0 --ion 1.0 --pep 1.0 --psm 1.0
   ```
   This sets the FDR to 100% on all levels, which allows PickedGroupFDR to achieve increased sensitivity over the regular FragPipe results.

**Running PickedGroupFDR**

5. Run the `run_picked_group_fdr.sh` script. This runs the `picked_group_fdr` and `picked_group_fdr.pipeline.update_fragpipe_results` modules.

This will produce a protein grouping result similar to MaxQuant's proteinGroups.txt format at `results/proteinGroups.txt`, as well as updated `psm.tsv` and `protein.tsv` file for each experiment in the `results` folder.

**Running IonQuant (optional)**

6. Run the `run_ionquant.sh` script with the path to the FragPipe software directory as the first argument:
   ```
   ./run_ionquant.sh "/path/to/FragPipe-19.1"
   ```

The quantified protein group results will now be available at `results/combined_protein.tsv`.